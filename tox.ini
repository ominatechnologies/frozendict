[tox]
envlist =
    {mypy,pytest}-py38
    docs-{html,pdf}
minversion = 3.23.1
skipsdist = false
toxworkdir = {homedir}/.tox_frozendict


[testenv]
download = true
passenv = TERM
usedevelop = true


[testenv:{cov,lint,mypy,pytest,test,watch}-py38]
commands =
    {mypy,test}: mypy frozendict
    {pytest,test}: pytest {posargs}
    {lint,test}: flake8 frozendict tests
    watch: pytest-watch -- {posargs}
    cov: coverage run -m pytest
    cov: coverage report
deps =
    -r{toxinidir}/requirements.dev.txt
    .
envdir = {toxworkdir}/test
setenv =
    BUILD_PATH={toxinidir}/build
    PYTHONHASHSEED=0


[testenv:_docs]
deps =
    pydata-sphinx-theme==0.6.3
    sphinx==4.0.2
    sphinx-autobuild==2021.3.14
setenv =
    OSOURCE=local


[testenv:docs-html]
commands = sphinx-build -b html -W docs build/docs-html
deps = {[testenv:_docs]deps}
envdir = {toxworkdir}/docs
setenv = {[testenv:_docs]setenv}


[testenv:docs-live]
allowlist_externals = open
commands =
    open http://0.0.0.0:80
    sphinx-autobuild -a -q --delay 1 --host 0.0.0.0 --port 80 --watch frozendict docs build/docs-html
deps = {[testenv:_docs]deps}
envdir = {toxworkdir}/docs
setenv = {[testenv:_docs]setenv}


[testenv:docs-pdf]
allowlist_externals = make
commands =
    sphinx-build -b latex docs build/docs-latex
    make -C build/docs-latex
deps = {[testenv:_docs]deps}
envdir = {toxworkdir}/docs
setenv = {[testenv:_docs]setenv}
