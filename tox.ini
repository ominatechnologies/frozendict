[tox]
envlist =
    mypy-py{38},
    pytest-py{38},
    docs-{html,pdf}
minversion = 3.23.1
skipsdist = false
toxworkdir = {homedir}/.tox_frozendict


[testenv]
download = true
passenv = TERM
usedevelop = true


[testenv:{cov,lint,mypy,pytest,test,watch}-py{38}]
commands =
    {mypy,test}: mypy frozendict
    {pytest,test}: pytest {posargs}
    {lint,test}: flake8 frozendict tests
    watch: pytest-watch -- {posargs}
    cov: coverage run -m pytest
    cov: coverage report
deps =
    git+https://github.com/wouter-vdb/pytest-watch@2021.01.29#egg=pytest-watch
    coverage==5.5
    flake8==3.9.2
    mypy==0.910
    types-colorama==0.4.2
    types-pytz==2021.1.0
    types-pyyaml==5.4.3
    pytest==6.2.4
envdir = {toxworkdir}/test
setenv =
    BUILD_PATH={toxinidir}/build
    OSOURCE=local
    PYTHONHASHSEED=0
    TEST_MODE=unit


[testenv:_docs]
description = Common specifications for docs environments.
deps =
    pydata-sphinx-theme==0.6.3
    sphinx==4.0.2
    sphinx-autobuild==2021.3.14
setenv =
    OSOURCE=local


[testenv:docs-html]
description = HTML docs building.
deps = {[testenv:_docs]deps}
envdir = {toxworkdir}/docs
commands =
    sphinx-build -b html -W docs build/docs-html
setenv = {[testenv:_docs]setenv}


[testenv:docs-live]
description = Live HTML docs building.
allowlist_externals = open
deps = {[testenv:_docs]deps}
envdir = {toxworkdir}/docs
commands =
    open http://0.0.0.0:80
    sphinx-autobuild -a -q --delay 1 --host 0.0.0.0 --port 80 --watch frozendict docs build/docs-html
setenv = {[testenv:_docs]setenv}


[testenv:docs-pdf]
description =
    PDF docs building.
    Note that this requires a TeX installation (see odev/README).
allowlist_externals = make
deps = {[testenv:_docs]deps}
envdir = {toxworkdir}/docs
commands =
    sphinx-build -b latex docs build/docs-latex
    make -C build/docs-latex
setenv = {[testenv:_docs]setenv}
